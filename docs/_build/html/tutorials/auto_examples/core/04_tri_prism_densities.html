

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Triangle Prism Densities &mdash; circle_bundles 0+unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/myst_sphinx_gallery.css?v=92de7a9e" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=27db1736"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Star Density Unwrapping" href="05_star_density_unwrapping.html" />
    <link rel="prev" title="Star Pyramid Meshes" href="03_triangle_meshes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            circle_bundles
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#basic-installation">Basic installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#optional-dependencies">Optional dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#minimal-working-example">Minimal working example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../quickstart.html#notes">Notes</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../theory/index.html">Theory</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/core_pipeline.html">Core pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.build_bundle.html">circle_bundles.build_bundle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.BundleResult.html">circle_bundles.BundleResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.DreimacCCConfig.html">circle_bundles.DreimacCCConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.LocalTrivResult.html">circle_bundles.LocalTrivResult</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/covers.html">Covers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.MetricBallCover.html">circle_bundles.MetricBallCover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.TriangulationStarCover.html">circle_bundles.TriangulationStarCover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.make_s2_fibonacci_star_cover.html">circle_bundles.make_s2_fibonacci_star_cover</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.make_rp2_fibonacci_star_cover.html">circle_bundles.make_rp2_fibonacci_star_cover</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/metrics.html">Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.EuclideanMetric.html">circle_bundles.EuclideanMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.S1AngleMetric.html">circle_bundles.S1AngleMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.RP1AngleMetric.html">circle_bundles.RP1AngleMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.S1UnitVectorMetric.html">circle_bundles.S1UnitVectorMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.RP1UnitVectorMetric.html">circle_bundles.RP1UnitVectorMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.RP2UnitVectorMetric.html">circle_bundles.RP2UnitVectorMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.T2FlatMetric.html">circle_bundles.T2FlatMetric</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/characteristic_classes.html">Characteristic classes and transitions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.O2Cocycle.html">circle_bundles.O2Cocycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.TransitionReport.html">circle_bundles.TransitionReport</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.ClassResult.html">circle_bundles.ClassResult</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/coordinatization.html">Coordinatization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.GlobalTrivializationResult.html">circle_bundles.GlobalTrivializationResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.BundleMapResult.html">circle_bundles.BundleMapResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.PullbackTotalSpaceResult.html">circle_bundles.PullbackTotalSpaceResult</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/weights_filtration.html">Weights filtration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.PersistenceResult.html">circle_bundles.PersistenceResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.CobirthResult.html">circle_bundles.CobirthResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.CodeathResult.html">circle_bundles.CodeathResult</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.MaxTrivialSubcomplex.html">circle_bundles.MaxTrivialSubcomplex</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/analysis.html">Analysis utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.fiberwise_clustering.html">circle_bundles.fiberwise_clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.get_cluster_persistence.html">circle_bundles.get_cluster_persistence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.get_filtered_cluster_graph.html">circle_bundles.get_filtered_cluster_graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.get_local_pca.html">circle_bundles.get_local_pca</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.plot_local_pca.html">circle_bundles.plot_local_pca</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.get_local_rips.html">circle_bundles.get_local_rips</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.plot_local_rips.html">circle_bundles.plot_local_rips</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.plot_fiberwise_pca_grid.html">circle_bundles.plot_fiberwise_pca_grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.plot_fiberwise_summary_bars.html">circle_bundles.plot_fiberwise_summary_bars</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.get_cocycle_dict.html">circle_bundles.get_cocycle_dict</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/circle_bundles.lift_base_points.html">circle_bundles.lift_base_points</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../extras/index.html">Extras and utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../extras/synthetic.html">Synthetic datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extras/viz.html">Visualization Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extras/optical_flow.html">Optical Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extras/special_metrics.html">Specialized and quotient metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../extras/generated/circle_bundles.Torus_DiagQuotientMetric_R4.html">circle_bundles.Torus_DiagQuotientMetric_R4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../extras/generated/circle_bundles.Torus_KleinQuotientMetric_R4.html">circle_bundles.Torus_KleinQuotientMetric_R4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../extras/generated/circle_bundles.RP2_TrivialMetric.html">circle_bundles.RP2_TrivialMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../extras/generated/circle_bundles.RP2_TwistMetric.html">circle_bundles.RP2_TwistMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../extras/generated/circle_bundles.RP2_FlipMetric.html">circle_bundles.RP2_FlipMetric</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../extras/generated/circle_bundles.S3QuotientMetric.html">circle_bundles.S3QuotientMetric</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Core</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_product_torus.html">Product Torus With Varying Fiber Radius</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_synthetic_natural_image_patches.html">Synthetic Natural Image Patches</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_triangle_meshes.html">Star Pyramid Meshes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Triangle Prism Densities</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_star_density_unwrapping.html">Star Density Unwrapping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../optical_flow/index.html">Optical Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../optical_flow/01_optical_flow_torus.html">Extended Torus Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quotients/index.html">Quotients</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quotients/01_quotients_of_s2_trivial.html">Quotients <span class="math notranslate nohighlight">\((\mathbb{S}^{2}\times\mathbb{S}^{1})/\mathbb{Z}_{2}\)</span> As Circle Bundles Over <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="../quotients/02_lens_spaces.html">Lens Spaces <span class="math notranslate nohighlight">\(L(p,1) = \mathbb{S}^{3}/\mathbb{Z}_{p}\)</span> As Circle Bundles Over <span class="math notranslate nohighlight">\(\mathbb{S}^{2}\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="../quotients/03_non_orientable_over_rp2.html">Quotients <span class="math notranslate nohighlight">\(\mathbb{S}^{3}/(\mathbb{Z}_{2p}\rtimes\mathbb{Z}_{2})\)</span> As Circle Bundles Over <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#core">Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#optical-flow">Optical Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#quotients">Quotients</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">circle_bundles</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Tutorials</a></li>
          <li class="breadcrumb-item"><a href="index.html">Core</a></li>
      <li class="breadcrumb-item active">Triangle Prism Densities</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/tutorials/auto_examples/core/04_tri_prism_densities.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="triangle-prism-densities">
<span id="example-04-tri-prism-densities"></span><h1>Triangle Prism Densities<a class="headerlink" href="#triangle-prism-densities" title="Link to this heading"></a></h1>
<p>An example application of the <code class="docutils literal notranslate"><span class="pre">circle_bundles</span></code> pipeline to a dataset where the underlying model is a non-orientable 3-manifold which admits a circle bundle structure over <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span> with non-trivial twisted Euler class.</p>
<p>Also a demonstration of the bundle-coordinatization feature of <code class="docutils literal notranslate"><span class="pre">circle_bundles</span></code> which produces a topologically-faithful lower-dimensional representation of the data.</p>
<p>We generate a dataset by applying random <span class="math notranslate nohighlight">\(SO(3)\)</span> rotations to the vertices of a triangular prism embedded in the unit ball, then constructing 3D density functions on <span class="math notranslate nohighlight">\(\overline{\mathbb{B}}_{1}(0)\)</span> from the rotated prisms which are Gaussian-distributed around their boundaries.  For analysis, we define an <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span>-valued feature map which roughly captures the axis of symmetry of each density. One can show that the underlying bundle structure is non-orientable with twisted Euler number <span class="math notranslate nohighlight">\(\pm 3\)</span>.</p>
<p>We recover the characteristic classes, which determines the topology of the total space up to homeomorphism (in particular, it is a quotient of <span class="math notranslate nohighlight">\(SO(3)\)</span>). We then restrict to a subset of the data which projects to an ‘equator’ <span class="math notranslate nohighlight">\(\mathbb{RP}^{1}\subset\mathbb{RP}^{2}\)</span> and verify that the restriction has the structure of a Klein bottle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">circle_bundles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cb</span>
</pre></div>
</div>
</div>
</div>
<p>Start by generating a synthetic dataset of 3D densities represented as vectors of length <span class="math notranslate nohighlight">\(32^{3}\)</span>. Record the corresponding triangle meshes for visualization (represented as vectors in <span class="math notranslate nohighlight">\(\mathbb{R}^{18}\)</span>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Create the template triangle mesh</span>
<span class="n">mesh</span><span class="p">,</span> <span class="n">face_groups</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">make_tri_prism</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Generate a random sample of SO(3) matrices</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">so3_data</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">sample_so3</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#Apply rotations to the template mesh</span>
<span class="n">mesh_data</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">get_mesh_sample</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">so3_data</span><span class="p">)</span>

<span class="c1">#Generate 3D densities from the rotated meshes</span>
<span class="n">grid_size</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1">#density resolution</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1">#density gaussian parameter</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">make_rotated_density_dataset</span><span class="p">(</span>
    <span class="n">mesh</span><span class="p">,</span>
    <span class="n">so3_data</span><span class="p">,</span>
    <span class="n">grid_size</span> <span class="o">=</span> <span class="n">grid_size</span><span class="p">,</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">#Create visualization functions for triangle meshes and 3D densities</span>
<span class="n">vis_density</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">make_density_visualizer</span><span class="p">(</span><span class="n">grid_size</span><span class="o">=</span><span class="n">grid_size</span><span class="p">)</span>
<span class="n">vis_mesh</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">make_tri_prism_visualizer</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">face_groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>View a small sample of the dataset, represented by 2D projections of the 3D densities and also by the triangle meshes used to produce the densities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">show_data_vis</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> 
    <span class="n">vis_density</span><span class="p">,</span> 
    <span class="n">max_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
    <span class="n">n_cols</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
    <span class="n">sampling_method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">show_data_vis</span><span class="p">(</span>
    <span class="n">mesh_data</span><span class="p">,</span> 
    <span class="n">vis_mesh</span><span class="p">,</span> 
    <span class="n">max_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
    <span class="n">n_cols</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
    <span class="n">sampling_method</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> 
    <span class="n">pad_frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/be76c869363c3e8201da70663a509acb5a5c3cc97ae5a1e349354bbaa3cf4ae5.png" src="../../../_images/be76c869363c3e8201da70663a509acb5a5c3cc97ae5a1e349354bbaa3cf4ae5.png" />
<img alt="../../../_images/f3fe6c9b5939e5c2efe31e7291f42641cd2a36cb0e28a91306cef779351f0d30.png" src="../../../_images/f3fe6c9b5939e5c2efe31e7291f42641cd2a36cb0e28a91306cef779351f0d30.png" />
</div>
</div>
<p><span class="math notranslate nohighlight">\(\textbf{Note:}\)</span> 2D projections of the 3D densities are computed by summing intensities along the z-axis, shown here as perpendicular to the screen.  In general, reflecting a rotated prism mesh through the z-axis may produce a very different 3D density, but the 2D projections will appear the same.  On the other hand, two prism meshes which differ by a rotation in the symmetry group of the prism yield indistinguishable 3D densities – this is a genuine symmetry of the dataset.</p>
<p>For each 3D density, compute the principal component (up to sign in <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span>) associated with the smallest eigenvalue – for densities in the dataset, this axis is always clearly defined and coincides with the axis of rotational symmetry. Record the <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span> projections as unit vectors in the upper hemisphere of <span class="math notranslate nohighlight">\(\mathbb{S}^{2}\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_points</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">get_density_axes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Construct an open cover of <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span> using a collection of nearly equidistant landmark points (see reference section):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_landmarks</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">cover</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">make_rp2_fibonacci_star_cover</span><span class="p">(</span><span class="n">base_points</span><span class="p">,</span> <span class="n">n_pairs</span> <span class="o">=</span> <span class="n">n_landmarks</span><span class="p">)</span>

<span class="n">summ</span> <span class="o">=</span> <span class="n">cover</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p class="rubric" id="cover-and-nerve-summary">Cover And Nerve Summary</p>
<ul class="simple">
<li><p>$n_\text{sets} = 60$, $n_\text{samples} = 5000$</p></li>
</ul>
<p><strong>Recorded Simplex Counts:</strong></p>
<ul class="simple">
<li><p>$#(\text{0-simplices}) = 60$</p></li>
<li><p>$#(\text{1-simplices}) = 177$</p></li>
<li><p>$#(\text{2-simplices}) = 118$</p></li>
<li><p><em>No recorded simplices in dimensions</em> $\ge 3$</p></li>
</ul>
<img alt="../../../_images/3cfb3becae49e1858d549a470edd8551157a82cd4c9b8adc07097da0ef592e41.png" src="../../../_images/3cfb3becae49e1858d549a470edd8551157a82cd4c9b8adc07097da0ef592e41.png" />
</div>
</div>
<p>Optionally run the cell below to view a Plotly visualization of the nerve of the open cover:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">cover</span><span class="o">.</span><span class="n">show_nerve</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Compute a persistence diagram for the data in each set <span class="math notranslate nohighlight">\(\pi^{-1}(U_{j})\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fiber_ids</span><span class="p">,</span> <span class="n">dense_idx_list</span><span class="p">,</span> <span class="n">rips_list</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">get_local_rips</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">cover</span><span class="o">.</span><span class="n">U</span><span class="p">,</span>
    <span class="n">to_view</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">56</span><span class="p">],</span> <span class="c1">#Choose a few diagrams to compute </span>
                       <span class="c1">#(or compute all by setting to None)</span>
    <span class="n">maxdim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">n_perm</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">plot_local_rips</span><span class="p">(</span>
    <span class="n">fiber_ids</span><span class="p">,</span>
    <span class="n">rips_list</span><span class="p">,</span>
    <span class="n">n_cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">titles</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/bradturow/anaconda3/envs/tda_env/lib/python3.10/site-packages/ripser/ripser.py:253: UserWarning: The input point cloud has more columns than rows; did you mean to transpose?
  warnings.warn(
/Users/bradturow/anaconda3/envs/tda_env/lib/python3.10/site-packages/ripser/ripser.py:253: UserWarning: The input point cloud has more columns than rows; did you mean to transpose?
  warnings.warn(
/Users/bradturow/anaconda3/envs/tda_env/lib/python3.10/site-packages/ripser/ripser.py:253: UserWarning: The input point cloud has more columns than rows; did you mean to transpose?
  warnings.warn(
</pre></div>
</div>
<img alt="../../../_images/1f9049c726bfe601a443b9085bfdb6302c5e72a267f4b3477c457fb2e3e486bb.png" src="../../../_images/1f9049c726bfe601a443b9085bfdb6302c5e72a267f4b3477c457fb2e3e486bb.png" />
</div>
</div>
<p>Optionally run the cell below to show a visualization of a ‘fat fiber’ of the projection map:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">center_ind</span> <span class="o">=</span> <span class="mi">201</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">dist_mat</span> <span class="o">=</span> <span class="n">cover</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">pairwise</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">cover</span><span class="o">.</span><span class="n">base_points</span><span class="p">)</span>
<span class="n">nearby_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist_mat</span><span class="p">[</span><span class="n">center_ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">fiber_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">nearby_indices</span><span class="p">]</span>
<span class="n">vis_data</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="p">[</span><span class="n">nearby_indices</span><span class="p">]</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>

<span class="c1"># PCA labeled with meshes</span>
<span class="n">cb</span><span class="o">.</span><span class="n">fiber_vis</span><span class="p">(</span>
    <span class="n">fiber_data</span><span class="p">,</span>
    <span class="n">vis_mesh</span><span class="p">,</span>
    <span class="n">vis_data</span><span class="o">=</span><span class="n">vis_data</span><span class="p">,</span>
    <span class="n">max_images</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">zoom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fiber PCA (Meshes)&quot;</span><span class="p">)</span>

<span class="c1"># PCA labeled with density projections</span>
<span class="n">cb</span><span class="o">.</span><span class="n">fiber_vis</span><span class="p">(</span>
    <span class="n">fiber_data</span><span class="p">,</span>
    <span class="n">vis_func</span><span class="o">=</span><span class="n">vis_density</span><span class="p">,</span>
    <span class="n">max_images</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">zoom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fiber PCA (Densities)&quot;</span><span class="p">)</span>

<span class="c1"># Base visualization</span>
<span class="n">cb</span><span class="o">.</span><span class="n">base_vis</span><span class="p">(</span>
    <span class="n">cover</span><span class="o">.</span><span class="n">base_points</span><span class="p">,</span>
    <span class="n">center_ind</span><span class="p">,</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">dist_mat</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Base neighborhood&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7353bbec60b9042ca12c2f6610b2df43d2489e4c049602d3179877fbcb48c8f5.png" src="../../../_images/7353bbec60b9042ca12c2f6610b2df43d2489e4c049602d3179877fbcb48c8f5.png" />
</div>
</div>
<p>Construct local circular coordinates, then compute approximate transition matrices and characteristic clases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bundle</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">cover</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                          
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{aligned}\textbf{Diagnostics} &amp; \\[6pt]\quad \text{Trivialization error} &amp;:\quad \varepsilon_{\text{triv}} := \sup_{(j\,k)\in\mathcal{N}(\mathcal{U})}\sup_{x\in\pi^{-1}(U_j\cap U_k)} d_{\mathbb{C}}(\Omega_{jk}f_k(x),f_j(x)) = 0.494\ \left(\varepsilon_{\text{triv}}^{\text{geo}}=0.159\pi\right)\\[3pt]\quad \text{Mean triv error} &amp;:\quad \bar{\varepsilon}_{\text{triv}} = 0.098\ \left(\bar{\varepsilon}_{\text{triv}}^{\text{geo}}=0.031\pi\right)\\[3pt]\quad \text{Surjectivity defect} &amp;:\quad \delta := \sup_{(i\,j\,k)\in\mathcal{N}(\mathcal{U})}\min_{v\in\{i,j,k\}} d_H\!\left(f_v(\pi^{-1}(U_i\cap U_j\cap U_k)),\mathbb{S}^1\right) = 0.787\\[3pt]\quad \text{Stability ratio} &amp;:\quad \alpha := \varepsilon_{\text{triv}}/(1-\delta) = 2.322\\[3pt]\quad \text{Cocycle error} &amp;:\quad \varepsilon_{\mathrm{coc}} := \sup_{(i\,j\,k)\in\mathcal{N}(\mathcal{U})}\left\|\Omega_{ij}\Omega_{jk}\Omega_{ki}-I\right\|_F = 0.346\\[3pt]\quad \text{Euler rounding dist.} &amp;:\quad d_\infty(\delta_\omega\theta,\tilde{e}) = 0.039\\[14pt]\textbf{Characteristic Classes} &amp; \\[6pt]\quad \text{Stiefel--Whitney} &amp;:\quad w_1 \neq 0\ (\text{non-orientable})\\[3pt]\quad \text{(twisted) Euler number} &amp;:\quad \pm 3\end{aligned}\end{split}\]</div>
</div>
</div>
<p>Show some correlations between local circular coordinates on overlaps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">compare_trivs</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/735100d46759ebc28b57a7f280a2069da2bed8aa3da01044e9db2d789adc094c.png" src="../../../_images/735100d46759ebc28b57a7f280a2069da2bed8aa3da01044e9db2d789adc094c.png" />
</div>
</div>
<p>Compute class persistence on the weights filtration of the nerve (see theory section for details):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pers</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">get_persistence</span><span class="p">(</span><span class="n">show</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{array}{lrrrrr}\textbf{Stage} &amp; k &amp; r &amp; |W_r^{(1)}| &amp; |W_r^{(2)}| &amp; |W_r^{(3)}| \\ \hline \text{Full nerve} &amp; 0 &amp; \infty &amp; 177 &amp; 118 &amp; 0 \\ \text{w₁ cobirth} &amp; 0 &amp; \infty &amp; 177 &amp; 118 &amp; 0 \\ \text{w₁ codeath} &amp; 122 &amp; 0.096 &amp; 55 &amp; 10 &amp; 0 \\ \text{Euler cobirth} &amp; 0 &amp; \infty &amp; 177 &amp; 118 &amp; 0 \\ \text{Euler codeath} &amp; 1 &amp; 0.231 &amp; 176 &amp; 116 &amp; 0\end{array}\end{split}\]</div>
</div>
</div>
<p>Observe that the twisted Euler class becomes trivial as soon as a single edge is removed.  This is to be expected, since the resulting subcomplex deformation retracts onto its 1-skeleton.  On the other hand, the orientation class does not become trivial until many edges are removed. This is also reasonable, since one can show that the restriction of a non-orientable bundle over <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span> to an ‘equator’ <span class="math notranslate nohighlight">\(\mathbb{RP}^{1}\)</span> is still non-orientable (hence non-trivial) – see below. In any case, observe that the variation in weight across this large collection of edges is relatively small, suggesting that our model is likely reliable across the entire nerve.</p>
<p>Now, to construct a lower-dimensional representation of the high-dimensional dataset, compute a classifying map to <span class="math notranslate nohighlight">\(Gr(2)\)</span> representing the underlying circle bundle and compute the pullback of the canonical circle bundle <span class="math notranslate nohighlight">\(V(2)\times_{O(2)}\mathbb{S}^{1}\)</span> (see theory section for details):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pullback_results</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">get_pullback_data</span><span class="p">(</span>
    <span class="n">subcomplex</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span>
    <span class="n">base_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">fiber_weight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">packing</span> <span class="o">=</span> <span class="s1">&#39;coloring2&#39;</span><span class="p">,</span>
    <span class="n">show_summary</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{aligned}\textbf{Coordinatization} &amp; \\[6pt]\quad \text{Cocycle projection dist.} &amp;:\quad d_{\infty}(\Omega,\Pi(\Omega)):=\sup_{(jk)\in\mathcal{N}(\mathcal{U})}\sup_{b\in U_j\cap U_k}\ \|\Omega_{jk}-\Pi(\Omega)_{jk}(b)\|_{F} = 0.313\\[3pt]\quad \text{Trivialization error} &amp;:\quad \varepsilon_{\mathrm{triv}}:=\sup_{(jk)\in\mathcal{N}(\mathcal{U})}\sup_{b\in U_j\cap U_k}\ d_{\mathbb{C}}\!\left(f_j(x),\ \Pi(\Omega)_{jk}(b)f_k(x)\right) = 0.401\ \ (\varepsilon_{\mathrm{triv}}^{\mathrm{geo}} = 0.128\pi)\\[3pt]\quad \text{Mean triv error} &amp;:\quad \bar{\varepsilon}_{\mathrm{triv}} = 0.082\ \ (\bar{\varepsilon}_{\mathrm{triv}}^{\mathrm{geo}} = 0.026\pi)\\[3pt]\quad \text{Grassmann proj. dist.} &amp;:\quad d_{\mathrm{Gr}}:=\sup_{b\in \cup_{U_j\in\mathcal{U}}U_j}\ \left\|\operatorname{sym}(C(b))-\Pi_{\mathrm{Gr}}(C(b))\right\|_F = 0.008\\[3pt]\quad \text{Stiefel proj. dist.} &amp;:\quad d_{\mathrm{St}}:=\sup_{U_j\in\mathcal{U}}\sup_{b\in U_j}\ \left\|\Pi_{\mathrm{St}}\!\big(\Phi_j(b)\big)-\Phi_j(b)\right\|_F = 0.168\\[3pt]\quad \text{Chart disagreement} &amp;:\quad \Delta:=\sup_{(jk)\in\mathcal{N}(\mathcal{U})}\sup_{b\in U_j\cap U_k}\ \|F_j(b)-F_k(b)\|_2 = 0.000\\[3pt]\quad \text{Frame packing} &amp;:\quad \texttt{coloring2}\quad (K=12)\\[3pt]\quad \text{Ambient space} &amp;:\quad \widetilde{E}\subset \mathbb{RP}^2\times\mathbb{R}^{24}\end{aligned}\end{split}\]</div>
</div>
</div>
<p>Notice that the pullback data lives in the ambient space <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\times\mathbb{R}^{24}\)</span>.  Check that the base projections of the pullback data coincide with the projections of the original densities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pullback_data</span> <span class="o">=</span> <span class="n">pullback_results</span><span class="o">.</span><span class="n">total_data</span>
<span class="n">proj_map</span> <span class="o">=</span> <span class="n">pullback_results</span><span class="o">.</span><span class="n">base_proj_map</span>
<span class="n">pullback_base_points</span> <span class="o">=</span> <span class="n">proj_map</span><span class="p">(</span><span class="n">pullback_data</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">pullback_base_points</span><span class="p">,</span> <span class="n">base_points</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Projections agree&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Projections agree
</pre></div>
</div>
</div>
</div>
<p>Construct the pullback bundle over <span class="math notranslate nohighlight">\(\mathbb{RP}^{2}\)</span> and verify it has the same classification as the original dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb_bundle</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span>
    <span class="n">pullback_results</span><span class="o">.</span><span class="n">total_data</span><span class="p">,</span>
    <span class="n">cover</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">total_metric</span> <span class="o">=</span> <span class="n">pullback_results</span><span class="o">.</span><span class="n">metric</span>  <span class="c1">#by default, we use the L2 product metric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{aligned}\textbf{Diagnostics} &amp; \\[6pt]\quad \text{Trivialization error} &amp;:\quad \varepsilon_{\text{triv}} := \sup_{(j\,k)\in\mathcal{N}(\mathcal{U})}\sup_{x\in\pi^{-1}(U_j\cap U_k)} d_{\mathbb{C}}(\Omega_{jk}f_k(x),f_j(x)) = 0.438\ \left(\varepsilon_{\text{triv}}^{\text{geo}}=0.140\pi\right)\\[3pt]\quad \text{Mean triv error} &amp;:\quad \bar{\varepsilon}_{\text{triv}} = 0.069\ \left(\bar{\varepsilon}_{\text{triv}}^{\text{geo}}=0.022\pi\right)\\[3pt]\quad \text{Surjectivity defect} &amp;:\quad \delta := \sup_{(i\,j\,k)\in\mathcal{N}(\mathcal{U})}\min_{v\in\{i,j,k\}} d_H\!\left(f_v(\pi^{-1}(U_i\cap U_j\cap U_k)),\mathbb{S}^1\right) = 0.807\\[3pt]\quad \text{Stability ratio} &amp;:\quad \alpha := \varepsilon_{\text{triv}}/(1-\delta) = 2.269\\[3pt]\quad \text{Cocycle error} &amp;:\quad \varepsilon_{\mathrm{coc}} := \sup_{(i\,j\,k)\in\mathcal{N}(\mathcal{U})}\left\|\Omega_{ij}\Omega_{jk}\Omega_{ki}-I\right\|_F = 0.407\\[3pt]\quad \text{Euler rounding dist.} &amp;:\quad d_\infty(\delta_\omega\theta,\tilde{e}) = 0.046\\[14pt]\textbf{Characteristic Classes} &amp; \\[6pt]\quad \text{Stiefel--Whitney} &amp;:\quad w_1 \neq 0\ (\text{non-orientable})\\[3pt]\quad \text{(twisted) Euler number} &amp;:\quad \pm 3\end{aligned}\end{split}\]</div>
</div>
</div>
<p>Now, restrict the original bundle to the ‘equator’ <span class="math notranslate nohighlight">\(\mathbb{RP}^{1}\subset \mathbb{RP}^{2}\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eps</span> <span class="o">=</span> <span class="mf">0.15</span>  <span class="c1"># thickness of equatorial band (in the chosen RP^2 embedding/coords)</span>

<span class="c1"># Points near the equator: last coordinate close to 0</span>
<span class="n">eq_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">base_points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">eps</span>

<span class="n">eq_data</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">eq_mask</span><span class="p">]</span>
<span class="n">eq_mesh_data</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="p">[</span><span class="n">eq_mask</span><span class="p">]</span>

<span class="c1"># Parametrize the equator by an angle in RP^1 (theta ~ theta + pi)</span>
<span class="n">eq_base_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">base_points</span><span class="p">[</span><span class="n">eq_mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">base_points</span><span class="p">[</span><span class="n">eq_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Equator band: </span><span class="si">{</span><span class="n">eq_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> samples (eps=</span><span class="si">{</span><span class="n">eps</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Equator band: 692 / 5000 samples (eps=0.15).
</pre></div>
</div>
</div>
</div>
<p>Constuct an open cover of <span class="math notranslate nohighlight">\(\mathbb{RP}^{1}\)</span> by metric balls around equally-spaced landmark points, then construct the restricted bundle object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_landmarks</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">landmarks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n_landmarks</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">overlap</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">radius</span> <span class="o">=</span> <span class="n">overlap</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n_landmarks</span><span class="p">)</span>

<span class="n">eq_cover</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">MetricBallCover</span><span class="p">(</span>
    <span class="n">eq_base_angles</span><span class="p">,</span>
    <span class="n">landmarks</span><span class="p">,</span>
    <span class="n">radius</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">cb</span><span class="o">.</span><span class="n">RP1AngleMetric</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">eq_cover_data</span> <span class="o">=</span> <span class="n">eq_cover</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">eq_bundle</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span>
    <span class="n">eq_data</span><span class="p">,</span>
    <span class="n">eq_cover</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \begin{aligned}\textbf{Diagnostics} &amp; \\[6pt]\quad \text{Trivialization error} &amp;:\quad \varepsilon_{\text{triv}} := \sup_{(j\,k)\in\mathcal{N}(\mathcal{U})}\sup_{x\in\pi^{-1}(U_j\cap U_k)} d_{\mathbb{C}}(\Omega_{jk}f_k(x),f_j(x)) = 0.488\ \left(\varepsilon_{\text{triv}}^{\text{geo}}=0.157\pi\right)\\[3pt]\quad \text{Mean triv error} &amp;:\quad \bar{\varepsilon}_{\text{triv}} = 0.111\ \left(\bar{\varepsilon}_{\text{triv}}^{\text{geo}}=0.035\pi\right)\\[3pt]\quad \text{Surjectivity defect} &amp;:\quad \delta := \sup_{(i\,j\,k)\in\mathcal{N}(\mathcal{U})}\min_{v\in\{i,j,k\}} d_H\!\left(f_v(\pi^{-1}(U_i\cap U_j\cap U_k)),\mathbb{S}^1\right) = 0.000\\[3pt]\quad \text{Stability ratio} &amp;:\quad \alpha := \varepsilon_{\text{triv}}/(1-\delta) = 0.488\\[3pt]\quad \text{Cocycle error} &amp;:\quad \varepsilon_{\mathrm{coc}} := \sup_{(i\,j\,k)\in\mathcal{N}(\mathcal{U})}\left\|\Omega_{ij}\Omega_{jk}\Omega_{ki}-I\right\|_F = 0.000\\[3pt]\quad \text{Euler rounding dist.} &amp;:\quad d_\infty(\delta_\omega\theta,\tilde{e}) = 0.000\\[14pt]\textbf{Characteristic Classes} &amp; \\[6pt]\quad \text{Stiefel--Whitney} &amp;:\quad w_1 \neq 0\ (\text{non-orientable})\\[3pt]\quad \text{Euler class} &amp;:\quad e = 0\ \text{(no 2-simplices)}\end{aligned}\end{split}\]</div>
</div>
</div>
<p>The characteristic classes confirm that the restricted dataset has the topology of a Klein bottle embedded in <span class="math notranslate nohighlight">\(\mathbb{R}^{32^{3}}\)</span>.</p>
<p>Compute a global ‘coordinate system’ for the restricted dataset after dropping the heaviest edge from the nerve of the cover of <span class="math notranslate nohighlight">\(\mathbb{RP}^{1}\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eq_triv_result</span> <span class="o">=</span> <span class="n">eq_bundle</span><span class="o">.</span><span class="n">get_global_trivialization</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Show a visualization of the nerve of the cover of <span class="math notranslate nohighlight">\(\mathbb{RP}^{1}\)</span> decorated with edge weights:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Compute a potential for the restricted orientation class</span>
<span class="n">eq_subcomplex</span> <span class="o">=</span> <span class="n">eq_bundle</span><span class="o">.</span><span class="n">get_max_trivial_subcomplex</span><span class="p">()</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">eq_subcomplex</span><span class="o">.</span><span class="n">kept_edges</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="n">eq_bundle</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">cocycle_used</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
<span class="n">phi_vec</span> <span class="o">=</span> <span class="n">Omega</span><span class="o">.</span><span class="n">orient_if_possible</span><span class="p">(</span><span class="n">edges</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">{</span><span class="n">lmk</span><span class="p">:</span> <span class="n">phi_vec</span><span class="p">[</span><span class="n">lmk</span><span class="p">]</span> <span class="k">for</span> <span class="n">lmk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eq_cover</span><span class="o">.</span><span class="n">landmarks</span><span class="p">))}</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">eq_bundle</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">omega_O1_used</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">eq_bundle</span><span class="o">.</span><span class="n">show_circle_nerve</span><span class="p">(</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/51c387ad0ecb1d177ac5bf5e1b98dbc5b08bcfa69ee4f3f64398f76db64ee8c2.png" src="../../../_images/51c387ad0ecb1d177ac5bf5e1b98dbc5b08bcfa69ee4f3f64398f76db64ee8c2.png" />
</div>
</div>
<p>The value of the orientation cocycle on each edge is shown in blue, and the removed edge is clearly indicated.  A potential for the cocycle after restriction is shown in red.</p>
<p>Finally, show a visualization of the coordinatized densities, represented by both the corresponding triangle meshes and 2D projections of the densities themselves:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">eq_base_angles</span><span class="p">,</span> <span class="n">eq_triv_result</span><span class="o">.</span><span class="n">F</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">cb</span><span class="o">.</span><span class="n">lattice_vis</span><span class="p">(</span>
    <span class="n">eq_mesh_data</span><span class="p">,</span>
    <span class="n">coords</span><span class="p">,</span>
    <span class="n">vis_mesh</span><span class="p">,</span>
    <span class="n">per_row</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">per_col</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">thumb_px</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">cb</span><span class="o">.</span><span class="n">lattice_vis</span><span class="p">(</span>
    <span class="n">eq_data</span><span class="p">,</span>
    <span class="n">coords</span><span class="p">,</span>
    <span class="n">vis_density</span><span class="p">,</span>
    <span class="n">per_row</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">per_col</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">thumb_px</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/cb797633626b7828dceaba7c7b2f7050c27f8f5631f55156ebd8c182e5462262.png" src="../../../_images/cb797633626b7828dceaba7c7b2f7050c27f8f5631f55156ebd8c182e5462262.png" />
</div>
</div>
<p>Notice that base projection roughly corresponds to axis of symmetry, as expected.  Upon carefuly inspection, one can see that coordinatized densities in each column approximately traverse a 1/3 rotation about the axis of symmetry, but the direction of rotation abruptly changes from counter-clockwise to clockwise between columns 1 and 2. This reflects the fundamental non-orientability of the underlying circle bundle structure over <span class="math notranslate nohighlight">\(\mathbb{RP}^{1}\)</span> (in particular, the underlying manifold is a Klein bottle).</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="03_triangle_meshes.html" class="btn btn-neutral float-left" title="Star Pyramid Meshes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="05_star_density_unwrapping.html" class="btn btn-neutral float-right" title="Star Density Unwrapping" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Brad Turow.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>